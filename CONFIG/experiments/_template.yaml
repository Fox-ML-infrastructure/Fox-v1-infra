# Experiment Config Template
# Copy this file and rename it to create a new experiment config
# Example: cp _template.yaml my_experiment.yaml

experiment:
  name: my_experiment  # Change this to your experiment name
  description: "Description of your experiment"

# ============================================================================
# DATA CONFIGURATION
# ============================================================================
data:
  # Data directory (relative to repo root or absolute path)
  data_dir: data/data_labeled_v2/interval=5m
  
  # List of symbols to use
  symbols: [AAPL, MSFT, GOOGL, TSLA, NVDA]
  
  # Bar interval (5m, 15m, 1h, etc.)
  interval: 5m  # or bar_interval: 5m (both work)
  
  # Maximum samples per symbol (caps data to prevent memory issues)
  max_samples_per_symbol: 50000
  
  # Maximum rows per symbol (additional cap for data loading)
  max_rows_per_symbol: 50000
  
  # Maximum rows for training (caps training data)
  max_rows_train: 100000
  
  # Minimum cross-sectional samples (minimum symbols per timestamp)
  min_cs: 10

# ============================================================================
# INTELLIGENT TRAINING CONFIGURATION
# ============================================================================
intelligent_training:
  # Auto-discover targets from data (true) or use manual_targets list (false)
  auto_targets: true
  
  # If auto_targets=true: number of top targets to select
  top_n_targets: 10
  
  # Maximum targets to evaluate (limits evaluation for faster testing)
  max_targets_to_evaluate: 10
  
  # Auto-discover features (true) or use manual_features list (false)
  auto_features: true
  
  # Number of top features to select
  top_m_features: 50
  
  # Training strategy
  strategy: single_task  # or multi_task, cascade
  
  # Run leakage diagnostics (slower but more thorough)
  run_leakage_diagnostics: false
  
  # Manual target list (used when auto_targets=false)
  # Examples:
  #   - fwd_ret_60m (forward return - non-repainting, honest baseline)
  #   - fwd_ret_30m, fwd_ret_120m (multiple forward return horizons)
  #   - y_first_touch_60m_0.8 (triple barrier - which barrier hits first)
  #   - y_will_peak_60m_0.8 (peak detection - may repaint)
  #   - y_will_valley_60m_0.8 (valley detection - may repaint)
  # manual_targets: [fwd_ret_60m]

# ============================================================================
# TARGET CONFIGURATION (Legacy/Reference)
# ============================================================================
targets:
  # Primary target (for reference, used as fallback if manual_targets not specified)
  primary: fwd_ret_60m

# ============================================================================
# FEATURE SELECTION CONFIGURATION
# ============================================================================
feature_selection:
  # Model families to use for feature selection
  # Options: lightgbm, xgboost, random_forest, neural_network, catboost, lasso,
  #          mutual_information, univariate_selection, rfe, boruta, stability_selection
  model_families:
    - lightgbm
    - xgboost
    - random_forest
    - catboost
    - neural_network
    - lasso
    - mutual_information
    - univariate_selection

# ============================================================================
# TRAINING CONFIGURATION
# ============================================================================
training:
  # Model families to train (same as feature selection for consistency)
  model_families:
    - lightgbm
    - xgboost
    - random_forest
    - catboost
    - neural_network
    - lasso
    - mutual_information
    - univariate_selection

# ============================================================================
# DECISION CONFIGURATION (Auto-Config Application)
# ============================================================================
decisions:
  # Application mode: "off" (assist mode only), "dry_run" (show patch), "apply" (auto-apply)
  apply_mode: "dry_run"  # Start with dry_run, then "apply" when confident
  
  # Minimum decision level to apply (0=no action, 1=warning, 2=recommendation, 3=action)
  min_level_to_apply: 2
  
  # Bayesian patch policy (Thompson sampling over discrete patch templates)
  use_bayesian: true
  bayesian:
    # Minimum runs before recommending patches
    min_runs_for_learning: 5
    # Minimum P(improve) to auto-apply
    p_improve_threshold: 0.8
    # Minimum expected gain to recommend
    min_expected_gain: 0.01
    # Reward metric to optimize
    reward_metric: "cs_auc"
    # Recency decay factor (higher = more weight on recent runs)
    recency_decay: 0.95
    # Decision level thresholds (all config-driven, no hardcoded values)
    level_3_threshold: 0.8   # P(improve) for auto-apply (level 3)
    level_3_gain: 0.01        # Expected gain for auto-apply (level 3)
    level_2_threshold: 0.6    # P(improve) for recommend (level 2)
    level_2_gain: 0.005       # Expected gain for recommend (level 2)
    level_1_threshold: 0.4    # P(improve) for warning (level 1)
    # Baseline window size (number of recent runs for baseline computation)
    baseline_window: 10

# ============================================================================
# PARALLEL EXECUTION CONFIGURATION
# ============================================================================
# Multi-target parallel execution (for faster target evaluation)
multi_target:
  # Enable parallel target evaluation (ProcessPoolExecutor)
  parallel_targets: true
  
  # Continue to next target if one fails
  skip_on_error: true
  
  # Save multi_target_summary.json
  save_summary: true

# Feature selection parallel execution
multi_model_feature_selection:
  # Enable parallel symbol processing (ProcessPoolExecutor)
  parallel_symbols: true

# Threading/parallel worker configuration
# These override threading_config.yaml settings
threading:
  parallel:
    # Max workers for ProcessPoolExecutor (CPU-bound tasks like target evaluation)
    # Set to null for auto-detect, or specific number (e.g., 4)
    max_workers_process: null  # null = auto-detect
    
    # Max workers for ThreadPoolExecutor (I/O-bound tasks)
    max_workers_thread: null    # null = auto-detect
    
    # Master switch for parallel execution
    enabled: true

# ============================================================================
# NOTES
# ============================================================================
# - Forward return targets (fwd_ret_*) are non-repainting and give honest baseline (~0.52-0.54)
# - Peak/valley targets (y_will_peak_*, y_will_valley_*) may repaint (scores > 0.70 suspicious)
# - First touch targets (y_first_touch_*) are generally non-repainting
# - Compare scores: honest baseline (~0.52-0.54) vs repainting targets (~0.70+) to see effect
# - Set auto_targets: false and specify manual_targets to test specific targets only
# - Use dry_run mode for decisions first, then apply when confident
